<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Put Scanner ‚Äî Quiet Powerhouse</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#06090f;--bg2:#0c1119;--bg3:#111827;--bdr:#1b2540;--t1:#e8ecf4;--t2:#94a3b8;--t3:#5a6a85;--grn:#22c55e;--gA:rgba(34,197,94,.12);--red:#ef4444;--rA:rgba(239,68,68,.1);--amb:#eab308;--aA:rgba(234,179,8,.1);--blu:#3b82f6;--bA:rgba(59,130,246,.1);--pur:#a78bfa;--pA:rgba(167,139,250,.12);--mono:'JetBrains Mono',monospace;--sans:'Outfit',system-ui,sans-serif}
body{background:var(--bg);color:var(--t1);font-family:var(--sans);min-height:100vh}
body::after{content:'';position:fixed;inset:0;background:radial-gradient(ellipse 80% 50% at 50% -10%,rgba(59,130,246,.04),transparent),radial-gradient(ellipse 60% 40% at 80% 110%,rgba(34,197,94,.03),transparent);pointer-events:none}
#root{position:relative;z-index:1;max-width:1140px;margin:0 auto;padding:20px 16px 80px}
.hdr{display:flex;align-items:center;gap:14px;padding:12px 0 20px;border-bottom:1px solid var(--bdr)}
.hdr h1{font-family:var(--mono);font-size:1.15rem;font-weight:600;letter-spacing:-.3px}
.hdr h1 b{color:var(--grn);font-weight:700}
.hdr .tag0{font-family:var(--mono);font-size:.6rem;background:var(--bg3);border:1px solid var(--bdr);border-radius:4px;padding:3px 8px;color:var(--t3);letter-spacing:.8px;text-transform:uppercase}
.hdr .live{background:var(--gA);border-color:rgba(34,197,94,.25);color:var(--grn)}
.hdr .off{background:var(--rA);border-color:rgba(239,68,68,.2);color:var(--red)}
.inp{background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:20px;margin:20px 0}
.row{display:flex;gap:12px;flex-wrap:wrap;align-items:end}
.fld{flex:1;min-width:90px}
.fld label{display:block;font-family:var(--mono);font-size:.58rem;font-weight:500;text-transform:uppercase;letter-spacing:1.2px;color:var(--t3);margin-bottom:5px}
.fld input{width:100%;background:var(--bg);border:1px solid var(--bdr);border-radius:6px;padding:9px 11px;font-family:var(--mono);font-size:.93rem;font-weight:500;color:var(--t1);outline:none;transition:border .15s}
.fld input:focus{border-color:var(--blu);box-shadow:0 0 0 2px rgba(59,130,246,.12)}
.fld input::placeholder{color:var(--t3);font-weight:300}
.fld .u{font-family:var(--mono);font-size:.52rem;color:var(--t3);margin-top:2px;letter-spacing:.5px}
.go{background:var(--blu);color:#fff;border:none;border-radius:6px;padding:9px 28px;font-family:var(--mono);font-size:.7rem;font-weight:600;cursor:pointer;letter-spacing:1px;text-transform:uppercase;transition:all .15s;white-space:nowrap;height:38px}
.go:hover{background:#2563eb;transform:translateY(-1px)}
.go:disabled{opacity:.5;cursor:not-allowed;transform:none}
.presets{display:flex;gap:6px;flex-wrap:wrap;margin-top:14px}
.pre{background:var(--bg);border:1px solid var(--bdr);border-radius:5px;padding:5px 12px;font-family:var(--mono);font-size:.68rem;color:var(--t2);cursor:pointer;transition:all .12s}
.pre:hover{border-color:var(--blu);color:var(--t1)}
.pre.neg{border-color:rgba(239,68,68,.2);color:var(--red)}.pre.neg:hover{border-color:var(--red)}
@keyframes fi{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.vrd{border-radius:10px;padding:18px 24px;margin-bottom:20px;display:flex;align-items:center;gap:18px;border:1px solid;animation:fi .3s ease}
.vrd.s{background:linear-gradient(135deg,rgba(34,197,94,.06),rgba(34,197,94,.01));border-color:rgba(34,197,94,.2)}
.vrd.h{background:linear-gradient(135deg,rgba(234,179,8,.06),rgba(234,179,8,.01));border-color:rgba(234,179,8,.2)}
.vrd.x{background:linear-gradient(135deg,rgba(239,68,68,.06),rgba(239,68,68,.01));border-color:rgba(239,68,68,.2)}
.vrd .ic{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
.vrd.s .ic{background:var(--gA)}.vrd.h .ic{background:var(--aA)}.vrd.x .ic{background:var(--rA)}
.vrd .tx{flex:1;min-width:0}.vrd .tx h2{font-family:var(--mono);font-size:.95rem;font-weight:600;margin-bottom:2px}.vrd .tx p{font-size:.78rem;color:var(--t2);line-height:1.5}
.vrd .sc{text-align:center;flex-shrink:0}.vrd .sc .n{font-family:var(--mono);font-size:2.2rem;font-weight:700;line-height:1}
.vrd.s .sc .n{color:var(--grn)}.vrd.h .sc .n{color:var(--amb)}.vrd.x .sc .n{color:var(--red)}
.vrd .sc .l{font-family:var(--mono);font-size:.52rem;text-transform:uppercase;letter-spacing:1.2px;color:var(--t3)}
.warn{background:var(--aA);border:1px solid rgba(234,179,8,.2);border-radius:8px;padding:10px 16px;margin-bottom:16px;font-family:var(--mono);font-size:.72rem;color:var(--amb);animation:fi .3s ease}
.cg{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:20px}
@media(max-width:700px){.cg{grid-template-columns:1fr 1fr}}
.cd{background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:16px 18px;animation:fi .3s ease}
.cd .ch{font-family:var(--mono);font-size:.55rem;font-weight:500;text-transform:uppercase;letter-spacing:1.4px;color:var(--t3);margin-bottom:10px}
.cd .cv{font-family:var(--mono);font-size:1.45rem;font-weight:700;margin-bottom:3px}
.cd .cs{font-size:.7rem;color:var(--t2);font-family:var(--mono);font-weight:300}
.gs{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:20px}
@media(max-width:600px){.gs{grid-template-columns:repeat(3,1fr)}}
.gk{background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:14px;text-align:center}
.gk .sy{font-family:var(--mono);font-size:.55rem;text-transform:uppercase;letter-spacing:1.4px;color:var(--t3);margin-bottom:6px}
.gk .gv{font-family:var(--mono);font-size:1.15rem;font-weight:600}
.gk .gn{font-size:.55rem;color:var(--t3);font-family:var(--mono);margin-top:3px}
.sb{background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:20px;margin-bottom:20px}
.sb h3{font-family:var(--mono);font-size:.55rem;text-transform:uppercase;letter-spacing:1.4px;color:var(--t3);margin-bottom:16px}
.br{display:flex;align-items:center;margin-bottom:10px;gap:10px}
.br .lb{font-family:var(--mono);font-size:.7rem;color:var(--t2);width:120px;flex-shrink:0;text-align:right}
.br .tk{flex:1;height:6px;background:rgba(255,255,255,.03);border-radius:3px;overflow:hidden}
.br .fl{height:100%;border-radius:3px;transition:width .5s ease}
.br .pt{font-family:var(--mono);font-size:.7rem;font-weight:600;width:48px;text-align:right;flex-shrink:0}
.sl{background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:20px;overflow-x:auto;margin-bottom:20px}
.sl h3{font-family:var(--mono);font-size:.55rem;text-transform:uppercase;letter-spacing:1.4px;color:var(--t3);margin-bottom:14px}
table{width:100%;border-collapse:collapse;min-width:620px}
th{font-family:var(--mono);font-size:.52rem;text-transform:uppercase;letter-spacing:1px;color:var(--t3);padding:7px 10px;text-align:right;border-bottom:1px solid var(--bdr);font-weight:500}
th:first-child{text-align:left}
td{font-family:var(--mono);font-size:.76rem;padding:9px 10px;text-align:right;border-bottom:1px solid rgba(255,255,255,.02);color:var(--t2)}
td:first-child{text-align:left;color:var(--t1);font-weight:500}
tr.sel{background:rgba(59,130,246,.07)}tr.sel td{color:var(--t1);font-weight:500}
tr.sup{border-left:3px solid var(--grn)}
tr:hover{background:rgba(255,255,255,.015)}
.tg{display:inline-block;font-family:var(--mono);font-size:.52rem;font-weight:600;padding:2px 7px;border-radius:3px;text-transform:uppercase;letter-spacing:.3px}
.tg-g{background:var(--gA);color:var(--grn)}.tg-a{background:var(--aA);color:var(--amb)}.tg-r{background:var(--rA);color:var(--red)}.tg-p{background:var(--pA);color:var(--pur)}
.sup-strip{background:var(--bg2);border:1px solid var(--bdr);border-radius:10px;padding:16px 20px;margin-bottom:20px}
.sup-strip h3{font-family:var(--mono);font-size:.55rem;text-transform:uppercase;letter-spacing:1.4px;color:var(--t3);margin-bottom:10px}
.sup-pills{display:flex;gap:8px;flex-wrap:wrap}
.sup-pill{font-family:var(--mono);font-size:.72rem;padding:5px 12px;border-radius:6px;border:1px solid}
.sup-pill.major{background:var(--gA);border-color:rgba(34,197,94,.25);color:var(--grn)}
.sup-pill.minor{background:rgba(255,255,255,.03);border-color:var(--bdr);color:var(--t2)}
.emp{text-align:center;padding:70px 20px;color:var(--t3)}
.emp .i{font-size:40px;margin-bottom:14px;opacity:.4}
.emp h2{font-family:var(--mono);font-size:.93rem;font-weight:500;color:var(--t2);margin-bottom:6px}
.emp p{font-size:.78rem;max-width:420px;margin:0 auto;line-height:1.6}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">
const { useState, useCallback, useEffect, useRef } = React;

const BRIDGE_URL = "https://web-production-51323.up.railway.app";
const BRIDGE = BRIDGE_URL || "http://localhost:8000";

/* ‚îÄ‚îÄ BLACK-SCHOLES (fallback when bridge is offline) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function NC(x){const a1=.254829592,a2=-.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=.3275911,s=x<0?-1:1;x=Math.abs(x)/Math.SQRT2;const t=1/(1+p*x);return .5*(1+s*(1-(((((a5*t+a4)*t)+a3)*t+a2)*t+a1)*t*Math.exp(-x*x)))}
function NP(x){return Math.exp(-.5*x*x)/Math.sqrt(2*Math.PI)}
function D12(S,K,T,r,s){if(T<=0||s<=0)return[0,0];const q=Math.sqrt(T),d1=(Math.log(S/K)+(r+.5*s*s)*T)/(s*q);return[d1,d1-s*q]}
function bsP(S,K,T,r,s){if(T<=0||s<=0)return Math.max(K-S,0);const d=D12(S,K,T,r,s);return K*Math.exp(-r*T)*NC(-d[1])-S*NC(-d[0])}
function bsD(S,K,T,r,s){if(T<=0||s<=0)return S<K?-1:0;return NC(D12(S,K,T,r,s)[0])-1}
function bsG(S,K,T,r,s){if(T<=0||s<=0||S<=0)return 0;return NP(D12(S,K,T,r,s)[0])/(S*s*Math.sqrt(T))}
function bsT(S,K,T,r,s){if(T<=0||s<=0)return 0;const d=D12(S,K,T,r,s);return(-(S*NP(d[0])*s)/(2*Math.sqrt(T))+r*K*Math.exp(-r*T)*NC(-d[1]))/365}
function bsV(S,K,T,r,s){if(T<=0||s<=0)return 0;return S*NP(D12(S,K,T,r,s)[0])*Math.sqrt(T)/100}
function calcGreeks(S,K,T,r,iv){return{price:bsP(S,K,T,r,iv),delta:bsD(S,K,T,r,iv),gamma:bsG(S,K,T,r,iv),theta:bsT(S,K,T,r,iv),vega:bsV(S,K,T,r,iv)}}

function offlineScore(S,K,dte,iv,r,vix,chg){
  const T=dte/365,g=calcGreeks(S,K,T,r,iv);if(vix>=35)return{sc:0,g,ann:0,bd:{}};let sc=0;
  const rg=vix<15?20:vix<20?17:vix<25?12:vix<28?6:2;sc+=rg;
  const dd=Math.abs(Math.abs(g.delta)-.2),dp=dd<.02?18:dd<.04?14:dd<.06?10:dd<.1?5:1;sc+=dp;
  const ann=(g.price/K)*(365/Math.max(dte,1)),pp=(ann>=.08&&ann<=.15)?14:(ann>=.06&&ann<=.25)?10:ann<.06?3:ann<=.35?6:0;sc+=pp;
  const dist=(S-K)/S,dsp=(dist>=.05&&dist<=.1)?14:(dist>.1&&dist<=.15)?10:(dist>=.03&&dist<.05)?6:dist<.03?0:5;sc+=dsp;
  const td=Math.abs(g.theta),tp=td>.05?12:td>.03?9:td>.01?5:2;sc+=tp;
  const di=chg<-2?16:chg<-1?13:chg<-.5?10:chg<0?5:chg<.5?2:chg<1.5?-2:-8;sc+=di;
  const gp=dte<14?-6:dte<21?-3:0;sc+=gp;
  return{sc:Math.max(Math.min(Math.round(sc),100),0),g,ann,bd:{regime:rg,delta:dp,premium:pp,distance:dsp,theta:tp,dip:Math.max(di,0),gamma:gp,support:0}}}

function offlineLadder(S,dte,iv,r,vix,chg){
  const rows=[],step=S>400?5:S>100?2.5:S>50?1:.5,seen={};
  for(let p=.02;p<=.16;p+=.005){const K=Math.round(S*(1-p)/step)*step;if(K<=0||seen[K])continue;seen[K]=1;
    const T=dte/365,g=calcGreeks(S,K,T,r,iv);if(Math.abs(g.delta)<.05||Math.abs(g.delta)>.45)continue;
    const res=offlineScore(S,K,dte,iv,r,vix,chg);
    rows.push({strike:K,delta:g.delta,gamma:g.gamma,theta:g.theta,vega:g.vega,prem:g.price,dist:(S-K)/S*100,ann:(g.price/K)*(365/dte)*100,sc:res.sc,iv:iv*100,on_support:false,support_info:""})}
  return rows.sort((a,b)=>b.sc-a.sc)}

/* ‚îÄ‚îÄ MAIN APP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function App() {
  const [fields, setFields] = useState({ticker:'',price:'',strike:'',iv:'',dte:'35',vix:'18',chg:'-0.5'});
  const [result, setResult] = useState(null);
  const [bridgeUp, setBridgeUp] = useState(null); // null=checking, true/false
  const [loading, setLoading] = useState(false);

  // Check bridge on mount
  useEffect(() => {
    fetch(BRIDGE + "/health", {signal: AbortSignal.timeout(2000)})
      .then(r => r.json())
      .then(d => setBridgeUp(d.status === "ok"))
      .catch(() => setBridgeUp(false));
  }, []);

  const set = (k, v) => setFields(prev => ({...prev, [k]: v}));
  const load = (t,p,k,i,d,v,c) => setFields({ticker:t,price:p,strike:k,iv:i,dte:d,vix:v,chg:c});

  // Live scan via bridge
  const scanLive = useCallback(async () => {
    if (!fields.ticker) return;
    setLoading(true);
    try {
      const res = await fetch(`${BRIDGE}/scan/${fields.ticker}?dte=${fields.dte || 35}`);
      const data = await res.json();
      if (data.error) { alert("Bridge error: " + data.error); setLoading(false); return; }

      const rec = data.recommended;
      if (!rec) { alert("No puts found for " + data.ticker); setLoading(false); return; }

      // Build result in same format as offline
      const contracts = data.contracts.map(c => ({
        strike: c.strike, delta: c.delta, gamma: c.gamma, theta: c.theta, vega: c.vega,
        prem: c.bs_price, dist: c.distance, ann: c.ann_return, sc: c.score,
        iv: c.iv, bid: c.bid, ask: c.ask, last: c.last, volume: c.volume, oi: c.oi,
        on_support: c.on_support, support_info: c.support_info,
      }));

      setResult({
        S: data.price, K: rec.strike, IV: rec.iv / 100, DTE: data.dte,
        VIX: data.vix, CHG: data.daily_change, r: 0.045,
        tk: data.ticker, sc: rec.score,
        g: rec, ann: rec.ann_return / 100,
        bd: rec.breakdown, ld: contracts,
        supports: data.supports || [], resistances: data.resistances || [],
        warnings: data.warnings || [], expiration: data.expiration, live: true,
      });
      // Sync fields
      setFields(prev => ({...prev, price: ''+data.price, strike: ''+rec.strike, iv: ''+rec.iv, dte: ''+data.dte, vix: ''+data.vix, chg: ''+data.daily_change}));
    } catch (e) {
      console.error(e);
      alert("Bridge connection failed. Is bridge.py running?");
    }
    setLoading(false);
  }, [fields.ticker, fields.dte]);

  // Offline scan (manual input)
  const scanOffline = useCallback(() => {
    const S=+fields.price, K=+fields.strike, IV=+fields.iv/100, DTE=+fields.dte, VIX=+fields.vix, CHG=+fields.chg, r=0.045;
    if (!S||!K||!IV||!DTE) return;
    const res = offlineScore(S,K,DTE,IV,r,VIX,CHG);
    const ld = offlineLadder(S,DTE,IV,r,VIX,CHG);
    setResult({S,K,IV,DTE,VIX,CHG,r,tk:fields.ticker.toUpperCase()||'‚Äî',sc:res.sc,
      g:{price:res.g.price,delta:res.g.delta,gamma:res.g.gamma,theta:res.g.theta,vega:res.g.vega},
      ann:res.ann,bd:res.bd,ld,supports:[],resistances:[],warnings:[],live:false});
  }, [fields]);

  const run = useCallback(() => {
    if (bridgeUp && fields.ticker && !fields.price) {
      scanLive();
    } else {
      scanOffline();
    }
  }, [bridgeUp, fields, scanLive, scanOffline]);

  const kd = (e) => { if (e.key === 'Enter') run(); };

  const a = result;
  const v = a ? (a.sc >= 70 ? 's' : a.sc >= 45 ? 'h' : 'x') : null;

  return (
    <div>
      <div className="hdr">
        <h1><b>$</b> Put Scanner</h1>
        <span className="tag0">quiet powerhouse</span>
        {bridgeUp === true && <span className="tag0 live">LIVE</span>}
        {bridgeUp === false && <span className="tag0 off">OFFLINE</span>}
      </div>

      <div className="inp">
        <div className="row">
          <div className="fld" style={{maxWidth:130}}>
            <label>Ticker</label>
            <input value={fields.ticker} placeholder="AAPL" onChange={e=>set('ticker',e.target.value)} onKeyDown={kd} />
            {bridgeUp && <div className="u" style={{color:'var(--grn)'}}>auto-fetch</div>}
          </div>
          <div className="fld"><label>Price</label><input type="number" step="any" value={fields.price} placeholder={bridgeUp?"auto":"235.50"} onChange={e=>set('price',e.target.value)} onKeyDown={kd}/><div className="u">$</div></div>
          <div className="fld"><label>Strike</label><input type="number" step="any" value={fields.strike} placeholder={bridgeUp?"auto":"225"} onChange={e=>set('strike',e.target.value)} onKeyDown={kd}/><div className="u">$</div></div>
          <div className="fld"><label>IV</label><input type="number" step="any" value={fields.iv} placeholder={bridgeUp?"auto":"22"} onChange={e=>set('iv',e.target.value)} onKeyDown={kd}/><div className="u">%</div></div>
          <div className="fld"><label>DTE</label><input type="number" value={fields.dte} placeholder="35" onChange={e=>set('dte',e.target.value)} onKeyDown={kd}/><div className="u">days</div></div>
          <div className="fld"><label>VIX</label><input type="number" step="any" value={fields.vix} placeholder={bridgeUp?"auto":"18"} onChange={e=>set('vix',e.target.value)} onKeyDown={kd}/><div className="u">level</div></div>
          <div className="fld"><label>Day Chg</label><input type="number" step="any" value={fields.chg} placeholder={bridgeUp?"auto":"-0.5"} onChange={e=>set('chg',e.target.value)} onKeyDown={kd}/><div className="u">%</div></div>
          <button className="go" onClick={run} disabled={loading}>{loading ? 'Loading...' : bridgeUp && fields.ticker && !fields.price ? 'Fetch + Scan' : 'Scan'}</button>
        </div>
        <div className="presets">
          {bridgeUp
            ? ['AAPL','MSFT','GOOGL','SPY','NVDA','MU','AMD','TSLA'].map(t =>
                <button key={t} className="pre" onClick={()=>{setFields({ticker:t,price:'',strike:'',iv:'',dte:'35',vix:'',chg:''});setTimeout(()=>document.querySelector('.go').click(),50)}}>{t}</button>)
            : <>
                <button className="pre" onClick={()=>load('AAPL','235','225','22','35','18','-0.7')}>AAPL</button>
                <button className="pre" onClick={()=>load('MSFT','415','395','20','35','18','-0.5')}>MSFT</button>
                <button className="pre" onClick={()=>load('GOOGL','182','172','26','35','18','-1.2')}>GOOGL</button>
                <button className="pre" onClick={()=>load('SPY','605','585','14','42','18','-0.3')}>SPY</button>
                <button className="pre" onClick={()=>load('NVDA','130','120','38','35','22','2.1')}>NVDA</button>
                <button className="pre neg" onClick={()=>load('TSLA','340','300','48','35','32','-4.5')}>TSLA crash</button>
              </>
          }
        </div>
      </div>

      {!a && <div className="emp">
        <div className="i">‚ö°</div>
        <h2>{bridgeUp ? 'Type a ticker and hit Enter' : 'Punch in a contract'}</h2>
        <p>{bridgeUp
          ? 'Bridge is connected ‚Äî just enter a ticker symbol. Price, IV, VIX, and the full options chain will be fetched automatically with K-means support detection.'
          : 'Enter the stock price, strike, and IV from your broker screen. Or run bridge.py for auto-fetch with K-means support levels.'}</p>
      </div>}

      {a && <div>
        {/* Warnings */}
        {a.warnings && a.warnings.map((w,i) => <div className="warn" key={i}>‚ö†Ô∏è {w.msg}</div>)}

        {/* Verdict */}
        <div className={`vrd ${v}`}>
          <div className="ic">{v==='s'?'‚úÖ':v==='h'?'‚è≥':'üö´'}</div>
          <div className="tx">
            <h2>{v==='s'?`SELL ${a.tk} $${a.K} PUT`:v==='h'?`HOLD ‚Äî ${a.tk} $${a.K} needs better setup`:`SKIP ‚Äî ${a.tk} $${a.K} not worth it`}</h2>
            <p>{v==='s'
              ?`${a.DTE}d DTE ¬∑ Œ¥${a.g.delta.toFixed(3)} ¬∑ $${a.g.price.toFixed(2)} prem ¬∑ ${(a.ann*100).toFixed(1)}% ann${a.CHG<-.5?' ¬∑ dip entry ‚ú®':''}${a.bd.support>0?' ¬∑ on K-means support üß±':''}`
              :v==='h'?`Score ${a.sc}/100 borderline.${a.CHG>.5?' Wait for pullback.':''}`:
              `Score ${a.sc}/100.${a.VIX>=28?' VIX elevated.':''}${a.ann<.06?' Premium thin.':''}`}
              {a.live && a.expiration && <span style={{color:'var(--t3)'}}> ¬∑ exp {a.expiration}</span>}
            </p>
          </div>
          <div className="sc"><div className="n">{a.sc}</div><div className="l">score</div></div>
        </div>

        {/* K-means Support Levels */}
        {a.supports && a.supports.length > 0 && (
          <div className="sup-strip">
            <h3>K-Means Support Levels</h3>
            <div className="sup-pills">
              {a.supports.map((s,i) => (
                <span key={i} className={`sup-pill ${s.type || (s.strength >= 6 ? 'major' : 'minor')}`}>
                  ${s.price.toFixed(2)} <span style={{opacity:.6,fontSize:'.6rem'}}>({s.touches}x ¬∑ {s.timeframe})</span>
                </span>
              ))}
            </div>
          </div>
        )}

        {/* Metric Cards */}
        <div className="cg">
          <div className="cd"><div className="ch">Premium</div><div className="cv" style={{color:a.g.price>1?'var(--grn)':undefined}}>${a.g.price.toFixed(2)}</div><div className="cs">${(a.g.price*100).toFixed(0)} / contract</div></div>
          <div className="cd"><div className="ch">Ann. Return</div><div className="cv" style={{color:a.ann>=.08?'var(--grn)':a.ann>=.05?'var(--amb)':'var(--t3)'}}>{(a.ann*100).toFixed(1)}%</div><div className="cs">on ${(a.K*100).toLocaleString()} secured</div></div>
          <div className="cd"><div className="ch">Distance</div><div className="cv">{((a.S-a.K)/a.S*100).toFixed(1)}% OTM</div><div className="cs">break-even ${(a.K-a.g.price).toFixed(2)}</div></div>
          <div className="cd"><div className="ch">Œ∏ Decay</div><div className="cv" style={{color:'var(--grn)'}}>${Math.abs(a.g.theta).toFixed(4)}/day</div><div className="cs">${(Math.abs(a.g.theta)*100).toFixed(2)}/day/ct</div></div>
          <div className="cd"><div className="ch">Cash Req.</div><div className="cv">${(a.K*100).toLocaleString()}</div><div className="cs">to secure 1 contract</div></div>
          <div className="cd"><div className="ch">Day Change</div><div className="cv" style={{color:a.CHG<0?'var(--red)':'var(--grn)'}}>{a.CHG>0?'+':''}{a.CHG.toFixed(2)}%</div><div className="cs">{a.CHG<-1?'strong dip ‚Äî prime entry':a.CHG<-.3?'red ‚Äî favorable':a.CHG<.3?'flat':a.CHG<1.5?'green ‚Äî weaker':'ripping ‚Äî worst'}</div></div>
        </div>

        {/* Greeks */}
        <div className="gs">
          <div className="gk"><div className="sy">Delta (Œî)</div><div className="gv" style={{color:'var(--blu)'}}>{a.g.delta.toFixed(4)}</div><div className="gn">‚âà{Math.round(Math.abs(a.g.delta)*100)}% assign</div></div>
          <div className="gk"><div className="sy">Gamma (Œì)</div><div className="gv" style={{color:a.g.gamma>.03?'var(--amb)':undefined}}>{a.g.gamma.toFixed(5)}</div><div className="gn">{a.g.gamma>.04?'high ‚Äî danger':a.g.gamma>.02?'moderate':'low ‚Äî stable'}</div></div>
          <div className="gk"><div className="sy">Theta (Œò)</div><div className="gv" style={{color:'var(--grn)'}}>{a.g.theta.toFixed(4)}</div><div className="gn">per share/day</div></div>
          <div className="gk"><div className="sy">Vega (ŒΩ)</div><div className="gv">{a.g.vega.toFixed(4)}</div><div className="gn">per 1% IV move</div></div>
          <div className="gk"><div className="sy">IV</div><div className="gv" style={{color:a.IV>.35?'var(--amb)':undefined}}>{(a.IV*100).toFixed(1)}%</div><div className="gn">{a.IV>.4?'elevated':a.IV>.25?'above avg':'normal'}</div></div>
        </div>

        {/* Score Breakdown */}
        <div className="sb">
          <h3>Score Breakdown</h3>
          {[
            {l:"Regime",p:a.bd.regime,m:20,c:'var(--blu)'},
            {l:"Delta",p:a.bd.delta,m:18,c:'var(--pur)'},
            {l:"Dip Entry",p:a.bd.dip,m:16,c:'var(--grn)'},
            {l:"Premium",p:a.bd.premium,m:14,c:'var(--amb)'},
            {l:"Distance",p:a.bd.distance,m:14,c:'var(--blu)'},
            {l:"Theta",p:a.bd.theta,m:12,c:'var(--grn)'},
            ...(a.bd.support > 0 ? [{l:"K-Means Support",p:a.bd.support,m:15,c:'var(--pur)'}] : []),
            ...(a.bd.gamma < 0 ? [{l:"Gamma Risk",p:a.bd.gamma,m:6,c:'var(--red)'}] : []),
          ].map((item,i) => (
            <div className="br" key={i}>
              <div className="lb">{item.l}</div>
              <div className="tk"><div className="fl" style={{width:`${Math.max(item.p/item.m*100,0)}%`,background:item.c,opacity:.8}}/></div>
              <div className="pt" style={{color:item.p<0?'var(--red)':item.c}}>{item.p>0?'+':''}{item.p}/{item.m}</div>
            </div>
          ))}
        </div>

        {/* Strike Ladder */}
        {a.ld && a.ld.length > 0 && (
          <div className="sl">
            <h3>Strike Ladder ‚Äî {a.tk} puts{a.live ? `, exp ${a.expiration}` : `, ${a.DTE}d`}</h3>
            <table>
              <thead><tr>
                <th style={{textAlign:'left'}}>Strike</th><th>Delta</th><th>Premium</th><th>Œ∏/Day</th><th>Dist %</th><th>Ann Ret</th><th>Score</th><th></th>
              </tr></thead>
              <tbody>
                {a.ld.slice(0,16).map((row,i) => (
                  <tr key={i} className={`${row.strike===a.K?'sel':''} ${row.on_support?'sup':''}`}>
                    <td>
                      ${row.strike.toFixed(row.strike%1?1:0)}
                      {row.on_support && <span className="tg tg-p" style={{marginLeft:6,fontSize:'.48rem'}}>SUP</span>}
                    </td>
                    <td>{row.delta.toFixed(3)}</td>
                    <td>${(row.prem||row.last||0).toFixed(2)}</td>
                    <td>${Math.abs(row.theta).toFixed(4)}</td>
                    <td>{row.dist.toFixed(1)}%</td>
                    <td>{row.ann.toFixed(1)}%</td>
                    <td style={{fontWeight:600,color:row.sc>=70?'var(--grn)':row.sc>=45?'var(--amb)':'var(--t3)'}}>{row.sc}</td>
                    <td><span className={`tg ${row.sc>=70?'tg-g':row.sc>=45?'tg-a':'tg-r'}`}>{row.sc>=70?'sell':row.sc>=45?'hold':'skip'}</span></td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>}
    </div>
  );
}

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
